;YUI.add("yui-throttle",function(t,n){t.throttle=function(n,i){if(-1===(i=i||(t.config.throttleTime||150)))return function(){n.apply(this,arguments)};var r=t.Lang.now();return function(){var o=t.Lang.now();o-r>i&&(r=o,n.apply(this,arguments))}}},"3.16.0",{requires:["yui-base"]});
;M.add("mt-xsstorage",function(e){var t,n,o,a=e.mt.cookie,r=e.Lang,i=M&&M.Env["data-conf"]||{},c="http://"+(i.rootHost||"www.meituan.com"),u=M&&M.DOMAIN_HOST||"meituan.com",l=function(){var e="teststorage",t="http:"===window.location.protocol;if(!window.JSON||!window.postMessage||!t)return!1;try{localStorage.setItem(e,e);var n=localStorage.getItem(e);return localStorage.removeItem(e),n===e}catch(o){return!1}}(),s=function(){if(t)return t;return t={getItem:function(e,t,n){e="_ls_"+e;var o=a.get(e);return n=n||null,t&&t.call(n,o),o},getAndRemove:function(e,n,o){var a=t.getItem(e,n,o);return localStorage.removeItem(e),a},setItem:function(t,n){t="_ls_"+t,r.isObject(n)&&(n=e.JSON.stringify(n)),a.set(t,n,a.getExpiresDate(30,0,0),"/",u)},removeItem:function(e){e="_ls_"+e,a.remove(e,"/",u)},appendItem:function(e,t){e="_ls_"+e;var n=a.get(e);a.set(e,n+t,a.getExpiresDate(30,0,0),"/",u)}}},m=function(){if(n)return n;var t=["setItem","removeItem","clear"];return n={getItem:function(e,t,n){var o=localStorage.getItem(e);return n=n||null,t&&t.call(n,o),o},getAndRemove:function(e,t,o){var a=n.getItem(e,t,o);return localStorage.removeItem(e),a},appendItem:function(e,t){var n=localStorage.getItem(e)||"";localStorage.setItem(e,n+t)}},e.Array.each(t,function(e){n[e]=function(){localStorage[e].apply(localStorage,arguments)}}),n},g=function(){if(o)return o;var t=e.Node.create('<iframe width="1" height="1" frameborder="0" style="position:absolute;top:0;left:-9999px;"></iframe>'),n={},a=0,r=[],i=!1;return o={getItem:function(e,t,n){o._apihub("getItem",{key:e,callback:t,context:n})},getAndRemove:function(e,t,n){o._apihub("getAndRemove",{key:e,callback:t,context:n})},setItem:function(e,t){o._apihub("setItem",{key:e,val:t})},appendItem:function(e,t){o._apihub("appendItem",{key:e,val:t})},removeItem:function(e){o._apihub("removeItem",{key:e})},clear:function(){o._apihub("clear")},_apihub:function(e,t){var c,u,l=t.callback,s={method:e,args:{key:t.key,value:t.val}};if(l&&(c=a++,u=t.context||null,n[c]={cb:l,ctx:u},s.args.rid=c),!i)return void r.push(s);o._sendRequest(s)},_sendRequest:function(n){e.Node.getDOMNode(t).contentWindow.postMessage(e.JSON.stringify(n),c)},_handleMsg:function(t){if(t){var o,a=t.rid;!e.Lang.isUndefined(a)&&(o=n[a])&&(o.cb.call(o.ctx,t.value),delete n[a])}}},t.set("src",c+"/xsstorage.html"),e.one("body").append(t),t.on("load",function(){i=!0,e.Array.each(r,o._sendRequest)}),e.one(window).on("message",function(e){if(e._event.origin===c){var t=JSON.parse(e._event.data);o._handleMsg(t)}}),o};e.namespace("mt.XSStorage"),e.mt.XSStorage={isSupportXSStorage:l,getInstance:function(e){e=e||{};var t=!!e.forceAsync,n=!!e.useCookie;return l?location.origin!==c||t?g():m():!!n&&s()}}},"1.0.0",{requires:["mt-base"]});
;M.add("mt-beacon",function(t){function n(n){var o=n[0],e=u[o];return!!t.Lang.isFunction(e)&&(e.apply(null,Array.prototype.slice.call(n,1)),!0)}function o(){a.getInstance().getAndRemove(i,function(t){var n,o,e;if(t)for(t=t.split(r),t.shift(),n=0;o=t.pop();n++)e=s[n]=m._createImage(),e.src=o})}var e=t.config["mt-beacon"]||{},a=t.mt.XSStorage,r="FORCHROME",i="eventlist",c=!t.UA.ie&&a.isSupportXSStorage,g=null,s=YUI.Env.beacon=YUI.Env.beacon||{},l=e.mbq||"_mbq",u={},f=t.config.win,m={mbq:null,addBeaconMethods:function(o,e){t.Object.each(o,function(n,o){e&&(n=t.bind(n,e)),u[o]=n});var a,r=f[l]&&f[l]._q,i=0;if(r)for(;i!==r.length;)a=r[i],n(a)?r.splice(i,1):i++},getBeaconMethods:function(){return u},blog:function(n){var o={};n&&t.mix(o,n),e.blog&&e.blog.data&&t.mix(o,"function"==typeof e.blog.data?e.blog.data():e.blog.data),o.url||(o.url=this.getCurrentLocation().pathname),o.domain||(o.domain=this.getCurrentLocation().host),this.beacon(o,2)},asynclog:function(n){if(n){var o={};t.mix(o,n),e.asynclog&&e.asynclog.data&&t.mix(o,"function"==typeof e.asynclog.data?e.asynclog.data():e.asynclog.data),o.url||(o.url=this.getCurrentLocation().pathname),o.domain||(o.domain=this.getCurrentLocation().host),this.beacon(o,4)}},eventlog:function(n,o,e,a){var r={ca:n,ac:o,la:e};a&&t.mix(r,a),r.url=r.url||this.getCurrentLocation().href,this.beacon(r,3)},localEventlog:function(n,o,e,a){var r={ca:n,ac:o,la:e};a&&t.mix(r,a),r.url=r.url||this.getCurrentLocation().href,this.beacon(r,5)},errorlog:function(n,o,a){var r={type:"jsdebug",level:n||"fatal",msg:o};a&&t.mix(r,a),e.errorlog&&e.errorlog.data&&t.mix(r,"function"==typeof e.errorlog.data?e.errorlog.data():e.errorlog.data),this.beacon(r,1)},beacon:function(t,n){this._postconfig(t),this._send(t,n)},_postconfig:function(n){e.data&&t.mix(n,"function"==typeof e.data?e.data():e.data),n.time||(n.time=t.Lang.now()),!n.r&&t.config.doc.referrer&&(n.r=t.config.doc.referrer)},_send:function(n,l){var u,f=e.domainHost||this.getCurrentLocation().hostname,m=e.cdnDomainHost||this.getCurrentLocation().hostname,d=t.Lang.now(),b=s[d]=this._createImage(),h=this.getCurrentLocation().protocol;switch(l){case 1:u="https:"===h?h+"//felog."+f+"/_.gif":h+"//fe."+m+"/_.gif";break;case 2:u=h+"//b."+f+"/_.gif";break;case 3:u=h+"//b."+f+"/_mt.gif";break;case 5:if(u=h+"//b."+f+"/_mt.gif",c){var p=u+"?"+t.QueryString.stringify(n);g&&clearTimeout(g);return a.getInstance().appendItem(i,r+p),void(g=setTimeout(function(){o(),g=null},1e3))}break;case 4:u=h+"//b."+f+"/_async.gif"}u&&(b.src=u+"?"+t.QueryString.stringify(n))},_createImage:function(){return new Image},getCache:function(){return s},getCurrentLocation:function(){return t.getLocation()}};t.namespace("mt.beacon"),t.mt.beacon=m,function(){var t=f[l]&&f[l]._q||[];f[l]=m.mbq=function(){var t=f[l]._q;n(arguments)||t.push(arguments)},f[l]._q=t,m.addBeaconMethods({blog:m.blog,eventlog:m.eventlog,localEventlog:m.localEventlog,asynclog:m.asynclog,errorlog:m.errorlog},m)}(),c&&o()},"1.0.0",{requires:["querystring-stringify-simple","mt-base","mt-xsstorage"]});
;M.add("mt-log",function(t){function n(n){var e,o;if(o=d._modules=d._modules||[],n&&o.push(n),d._isblogdone){for(e=o.length-1;e>=0;e--)a("asynclog",t.mix(o[e],d.pageviewData));d._modules=[]}}var e=t.config["mt-log"]||{},o=t.throttle,i=t.mt.beacon,a=i.mbq,r=function(){var t,n=0,i={};return function(r,d,c){if(!e.error||!e.error.disable){var u=r+d,g=i[u];g||(g=function(){n=t===u?n:0,t=u,n++>=10||a("errorlog",r,d,c)},i[u]=o(g,500)),g()}}}(),d={pageview:function(o){function i(){t.config.win._gat&&t.config.win._gat._getTracker?r():v>u?r(g):(t.config.win.setTimeout(function(){i()},c),v+=c)}function r(t){f||(d.pageviewData.expire=t||0,a("blog",d.pageviewData),f=!0,d._isblogdone=!0,n())}var d=this,c=100,u=15e3,g=1,v=0,f=!1;t.config.win.setTimeout(function(){o=o||{};var n={};t.mix(n,o.extra),t.mix(n,d._getNavigationTiming()),e.pageview&&e.pageview.data&&t.mix(n,"function"==typeof e.pageview.data?e.pageview.data():e.pageview.data),d.pageviewData=n,!1===o.hasGA?r():i(),t.one(t.config.win).on("beforeunload",function(){r(2)})},200)},moduleview:function(o){if(o&&o.pm){var i={};t.mix(i,o),e.moduleview&&e.moduleview.data&&t.mix(i,"function"==typeof e.moduleview.data?e.moduleview.data():e.moduleview.data),n(i)}},error:r,_getNavigationTiming:function(){if("function"!=typeof[].map)return{};var n=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"],e={},o=t.config.win.performance;return o?(function(){var t=o.timing;if(t&&t.navigationStart){var i=[];i=n.map(function(n){return+t[n]||-1}).map(function(n){return n-=t.navigationStart,n<0?-1:n}),e.pt_start=t.navigationStart,e.pt_index=i.join(",")}}(),function(){var t=o.navigation;t&&(e.pn_redirect=t.redirectCount,e.pn_type=t.type)}(),e):{}}};t.namespace("mt.log"),t.mt.log=d,i.addBeaconMethods({trackPageview:d.pageview,trackModuleview:d.moduleview,logJsError:d.error},d),t.config.debug||(t.config.win.onerror=function(n,e,o){return d.error("fatal",n,{src:"window",url:e||t.getLocation().href,line:o}),!0})},"1.0.0",{requires:["node","yui-throttle","mt-beacon"]});
;M.add("mt-tracker",function(Y){function decodeAttr(nd,attr){var str=nd.getAttribute(attr);if(!str)return null;try{return eval("("+str+")")}catch(ex){return null}}var MT_EVENT="mtevent",GA_EVENT="gaevent",MT_MODULE="mod",D_MT_EVENT="data-"+MT_EVENT,D_MT_MODULE="data-"+MT_MODULE,_mbq=Y.mt.beacon.mbq;Y.namespace("mt.tracker"),Y.mt.tracker={init:function(){var t={mtevent:this.trackMTEvent,gaevent:this.trackGACustomEvent,gaexternal:this.trackGAExternalLink,mtmodule:this.trackMTModule};Y.Array.each(arguments,function(e){t[e]()})},trackMTModule:function(){Y.one("body").delegate("click",function(t){var e=t.target;if(e.hasClass("data-mod-enabled")||"a"===e.get("tagName").toLowerCase()||e.ancestor("a")){var a=this.getAttribute(D_MT_MODULE);if(!a||2===a.length){var n={pm:a},c=e.ancestor("a",!0),r=c&&c.getData("mod-extra");r&&(r=Y.JSON.parse(r),n=Y.mix(n,r)),_mbq("localEventlog","UserAction","Click","module/click",n)}}},"["+D_MT_MODULE+"]")},trackMTEvent:function(){Y.one(document.body).delegate("click",function(){var t,e,a,n=decodeAttr(this,D_MT_EVENT),c={};n&&(this.ancestors("[data-mteventnd]").each(function(t){Y.mix(c,decodeAttr(t,"data-mteventnd"),!0)}),"undefined"==typeof c.ca&&(c.ca="InnerLink"),"undefined"==typeof c.ac&&(c.ac="Click"),Y.mix(n,c),t=n.ca,e=n.ac,a=n.la,delete n.ca,delete n.ac,delete n.la,_mbq("localEventlog",t,e,a,n))},"["+D_MT_EVENT+"]")},trackGACustomEvent:function(){var t=Y.one(document.body),e=GA_EVENT;t.delegate("click",function(){var t=this.getAttribute(e);if(t){var a=t.split("|");a.length<3&&a.unshift("InnerLink","Click"),!a[2]&&this.get("href")&&(a[2]=this.get("href").replace("http://","")),_gaq&&_gaq.push(["_trackEvent"].concat(a))}},"["+e+"]")},trackGAExternalLink:function(){Y.one(document.body).delegate("click",function(){var t,e,a=this.get("href"),n=/^(http:\/\/|mailto:)/;if(a&&n.test(a)){if(a=a.replace("http://",""),t=a.indexOf("?"),e=this.getAttribute("galabel"),t>0&&(a=a.substring(0,t)),/\.(meituan|mt|sankuai)\.com/.test(a))return;e&&(a+="#label="+e),_gaq&&_gaq.push(["_trackEvent","OutLink","Click",a])}},"a")}}},"1.0.0",{requires:["node","event","mt-beacon"]});
;M.add("www-acmtracker",function(n){function e(e){var i="",a=[],t={},r=e.length;n.Array.each(e,function(n,e){if(i+=n,i.length>c)return a.push(i),void(i="");e!==r-1&&(i+=",")}),i&&a.push(i),a.length&&n.Array.each(a,function(n){t.recv=n,window._mbq("asynclog",t)})}var c=1400,i={sendView:function(c){if(c&&c.length){var i;i=[],n.Lang.isString(c)&&(c=c.split(",")),n.Array.each(c,function(n){n&&i.push(n)}),e(i)}},sendClick:function(n){window._mbq("localEventlog","UserAction","Click","rec/hit",{reccacm:n})}};n.mt.beacon.addBeaconMethods({sendReclsView:i.sendView,sendReclsClick:i.sendClick},i)},"1.0.0",{requires:["www-base","mt-beacon"]});
