;M.add("w-bubbletip",function(e){var t=e.mt.util,i=e.WidgetPositionAlign,n={top:[i.BC,i.TC],right:[i.LC,i.RC],bottom:[i.TC,i.BC],left:[i.RC,i.LC],"top-left":[i.BL,i.TL],"top-right":[i.BR,i.TR],"right-top":[i.TL,i.TR],"right-bottom":[i.BL,i.BR],"bottom-left":[i.TL,i.BL],"bottom-right":[i.TR,i.BR],"left-top":[i.TR,i.TL],"left-bottom":[i.BR,i.BL],"top-left-area":[i.BR,i.TC],"top-right-area":[i.BL,i.TC],"right-top-area":[i.BL,i.RC],"left-top-area":[i.BR,i.LC],"right-bottom-area":[i.TL,i.RC],"left-bottom-area":[i.TR,i.LC],"bottom-left-area":[i.TR,i.BC],"bottom-right-area":[i.TL,i.BC]},o=function(){o.superclass.constructor.apply(this,arguments)};o.NAME="BubbleTip",o.CSS_PREFIX="widget-bubbletip",o.STATUS_HIDE=0,o.STATUS_SHOW=1,o.ATTRS={node:{value:null,setter:e.one,writenOnce:!0},id:{value:"",writeOnce:!0},tip:{value:"",writeOnce:!0},alignment:{value:"bottom"},distance:{value:5},show:{value:!1},showDelay:{value:200},hideDelay:{value:500},showClose:{value:!1},forceClose:{value:!1},showType:{value:"mouseover"},hideType:{value:"mouseout"},anim:{value:!0},theme:{value:"light"}},e.extend(o,e.Overlay,{initializer:function(){var e=this;e._timer=null,e._status=o.STATUS_HIDE,e._isMouseOver=!1,e._handles={},e.publish("show",{emitFacade:!0,defaultFn:e._defShowFn}),e.publish("hide",{emitFacade:!0,defaultFn:e._defHideFn}),e.publish("close",{emitFacade:!0,defaultFn:e._defCloseFn})},destructor:function(){t.detachHandle(this._handles)},renderUI:function(){var t=this,i=t.get("id"),n=t.get("tip"),o=t.get("contentBox"),s=t.get("show"),a=t.get("showClose"),l=t.get("forceClose"),u=t.get("zIndex"),r=t.get("theme");a||l?(o.setHTML(e.Lang.sub('<div class="content">{tip}</div><a class="close" title="关闭">×</a><span class="triangle-border"></span><span class="triangle-fill"></span>',{tip:n})),o.addClass(t.getClassName("with-close"))):o.setHTML(e.Lang.sub('<div class="content">{tip}</div><span class="triangle-border"></span><span class="triangle-fill"></span>',{tip:n})),r&&o.addClass("theme-"+r),t.set("zIndex",u||9999),t.set("visible",!1),i&&t.get("boundingBox").set("id",i),s&&t.show()},bindUI:function(){function i(){u===r&&n._status===o.STATUS_HIDE||("mouseout"===r?n._delayOperation("hide",n.hide):n.close())}var n=this,s=n.get("node"),a=n.get("contentBox"),l=n.get("forceClose"),u=n.get("showType"),r=n.get("hideType"),d=e.one(window);n._handles.mouseOver=e.all([s,a]).on({mouseover:function(){n._isMouseOver=!0},mouseout:function(){n._isMouseOver=!1}}),n._handles.showByTrigger=s.on(u,function(){u===r&&n._status===o.STATUS_SHOW||n._delayOperation("show",n.show)}),l||(n._handles.hideByTrigger=s.on(r,function(){i()}),n._handles.hideByContent=a.on(r,function(){i()})),n._handles.close=a.delegate("click",function(){n.close()},".close"),n._handles.resize=d.on("resize",t.throttle(function(){n._setAlign()})),n._handles.pageheight=e.Global.on("PageHeight:change",t.throttle(function(){n._setAlign()}))},_delayOperation:function(e,t){var i=this,n=i.get(e+"Delay");i._timer&&(window.clearTimeout(i._timer),i._timer=null),i._timer=window.setTimeout(function(){t.call(i)},n)},show:function(){return this.fire("show"),this},_defShowFn:function(){var t,i=this,n=i.get("contentBox");i._status!==o.STATUS_SHOW&&(n.setStyle("opacity",0),i.set("visible",!0),i._status=o.STATUS_SHOW,i._setAlign(),i.get("anim")?(t=new e.Anim({node:n,to:{opacity:1},duration:.15}),t.run()):n.setStyle("opacity",1))},hide:function(e){return!e&&this._isMouseOver||this.fire("hide"),this},_defHideFn:function(){var t,i=this,n=i.get("contentBox");i._status!==o.STATUS_HIDE&&(i.get("anim")?(t=new e.Anim({node:n,to:{opacity:0},duration:.15}),t.on("end",function(){i.set("visible",!1),i._isMouseOver=!1,i._status=o.STATUS_HIDE}),t.run()):(n.setStyle("opacity",0),i.set("visible",!1),i._isMouseOver=!1,i._status=o.STATUS_HIDE))},close:function(){return this.fire("close"),this},_defCloseFn:function(){this.hide(!0)},_setAlign:function(){var e=this,t=e.get("alignment"),i=t.split("-"),o=e.get("distance"),s=e.get("contentBox"),a=e.get("node"),l={top:"auto",right:"auto",bottom:"auto",left:"auto"};s.addClass(e.getClassName(i[0])),i[1]&&s.addClass(e.getClassName(t)),n[t]&&e.set("align",{node:a,points:n[t]}),o=-1*parseInt(o,10),l[i[0]]=o+"px",s.setStyles(l)},setTip:function(e){if(e){var t=this.get("contentBox"),i=t.one(".content");this.set("tip",e),i&&i.setHTML(e)}}}),e.mt.widget.BubbleTip=o},"1.0.0",{requires:["mt-base","anim","overlay","node"],skinnable:!0});
