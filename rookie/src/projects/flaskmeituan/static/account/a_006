;M.add("www-tips",function(e){var t=e.Node,n=e.UA.ie,s=e.mt.util,i=s.Cookie;e.mt.www.SysMsg={show:function(n,s){var i,o,a,c,r=e.all(".sysmsgw");r.size()?i=r.item(0):(i=t.create('<div class="sysmsgw common-tip"><div class="sysmsg"><span class="J-msg-content"></span><span class="close common-close">关闭</span></div></div>'),c=e.one("#hdw")||e.one("#site-mast"),c.insert(i,"after")),o=i.one(".J-tip-status"),o&&o.remove(!0),o=t.create('<span class="J-tip-status tip-status"></span>'),o.addClass("tip-status--"+n),a=i.one(".J-msg-content, p"),a.setHTML(s),i.set("id","sysmsg-"+n),a.prepend(o),this.initEvent()},remove:function(t){var n=e.all(".sysmsgw");n.size()&&(t?n.remove(!0):n.item(0).remove(!0))},initEvent:function(){var t=e.one("#sysmsg-error, #sysmsg-success");t&&t.delegate("click",function(){t.remove(!0)},".close")},init:function(t,o){if(t){var a;a=t._node?t:e.Node.create(t),o=o&&e.one(o)||e.one("body"),o.prepend(a),e.Global.fire("PageHeight:change"),n&&n<8&&s.reflow(),a.delegate("click",function(){var e=s.decodeAttr(a,"params");if(e&&e.cookieClose){var t=i.getExpiresDate(15,0,0);i.set("systip",!0,t,"/","."+M.DOMAIN_HOST)}a.remove(!0),6===n&&s.reflow()},".close")}}},e.mt.www.CommonTips={_isFirstMsg:!0,init:function(t,i,o){function a(t,n){var o;i=s.getEvalRes(n),0!==i.status&&i.msg?(o="<p>"+i.msg+"</p>",l.setAttribute("gaevent",i.gaevent)):m=!0,m?c.effect.fadeOut(!1,200,function(){e.Global.fire("PageHeight:change")}):c.effect.fadeOutSimple(!1,200,function(){u.show(c,o)})}if(t){var c;c=t._node?t:e.Node.create(t),o=o&&e.one(o)||e.one("body"),o.prepend(c),c.show(),e.Global.fire("PageHeight:change"),n&&n<8&&s.reflow();var r,l=c.one(".close"),d=s.decodeAttr(c,"commontips"),m=!1,u=this;c.plug(e.mt.plugin.Effect),c.delegate("click",function(){if(!(r&&r.isInProgress()||m)){var t={};i&&(i.type&&(t.type=i.type),i.msgid&&(t.msgid=i.msgid)),r=e.io("/index/commontips",{method:"POST",data:e.merge(d,t),on:{success:a}})}},".close")}},show:function(e,t){e.one(".content").setHTML(t),e.effect.fadeInSimple("middle",function(){n&&n<8&&s.reflow()}),this.trackViewEvent(e)},trackViewEvent:function(e){e.all("[data-ga-params]").each(function(e){var t=s.data(e,"ga-params").split("|");_gaq.push(["_trackEvent"].concat(t))})}},e.mt.www.VipBubble={success:function(t,n,s){var i=s.node,o=i.ancestor().insertBefore(n.markup,i);e.mt.www.VipBubble.bindBubbleEvents(o,n.cn)},bindBubbleEvents:function(e,t){e.show(),e.delegate("click",function(){e.hide(),i.set(t,!0,i.getExpiresDate(20,0,0),"/","."+M.DOMAIN_HOST)},".close")}},e.mt.www.MsgCenter={success:function(t,n,s){var i=s.node,o=e.one("#J-my-msg"),a=n.total;n.msglist&&(i.show(),i.appendChild(n.msglist),o.on("hover",function(){e.mt.www.MsgCenter.initScroll(e.one("#J-header-msg-list"))}),a>0&&function(){for(var e=["/deal/buy/","/order/check/","/order/return/"],t=document.location.pathname,n=0;n<e.length;n++)if(0===t.indexOf(e[n]))return!1;return!0}()&&o.one(".J-title").insert('<span class="J-msg-count msg-count">'+a+"</span>","after"))},bindMsgEvent:function(t,n,s,i){function o(t,n,s){n&&e.io(t,{method:"POST",data:{msgid:n.getData("mid")},on:{success:s}})}function a(t){var n=0,s=e.one("#J-my-msg .J-msg-count");t.hasClass("isread")||s&&(n=parseInt(s.get("innerHTML"),10),n--,n>0?s.setHTML(n):s.ancestor().remove(!0))}t=e.one(t),i=i||"nav",t&&(t.delegate("click",function(e){var t,s;e.target.hasClass("J-close")||(t="a"===this.get("tagName").toLowerCase()?this.ancestor("li"):this,e.halt(),o("/message/read",t,function(){a(t),t.addClass("isread"),n&&n()}),s=this.getAttribute("href"),window._gaq.push(["_trackEvent","InnerLink","Click",i+"/drop/msgread/"+t.getData("mid")]),s?window.open(s,"_blank"):"J-header-msg-list"===t.ancestor("ul").get("id")&&window.open("/message/","_blank"))},"a, li"),t.delegate("click",function(){var e=this.ancestor("li");e.hide(200,null,function(){t.all("[data-mid]").some(function(e){return"none"!==e.getStyle("display")})||t.replace('<p class="no-msg">暂无新消息</p>'),o("/message/delete",e,function(){a(e)}),s&&s(),window._gaq.push(["_trackEvent","InnerLink","Click",i+"/drop/msgdel/"+e.getData("mid")])})},".J-close"),t.delegate("hover",function(){this.addClass("current")},function(){this.removeClass("current")},"li"))},initScroll:function(t){function n(){a=t.get("scrollHeight"),c=parseInt(t.get("clientHeight"),10),r=c-2*w,g=t.get("scrollTop"),l=r/a,a<=c?u.setStyles({height:"0px",top:w+"px",right:"2px"}):u.setStyles({height:l*c+"px",top:g*l+w+"px",right:"2px"})}function s(){t.on("hover",function(){m=o()},function(){m&&m.detach()})}function i(){return window.setTimeout(function(){u.setStyle("opacity","0")},f)}function o(){return t.on({mousewheel:function(e){e.halt(!0),d&&(window.clearTimeout(d),d=null),u.setStyle("opacity","0.5"),d=i(),(e.wheelDelta*h<=0||g>=0&&g<=a-c)&&(e.wheelDelta>0?(g-=p,h=1):(g+=p,h=-1)),g<0?g=0:g>=a-c&&(g=a-c),u.setStyle("opacity",.5),u.setStyle("top",g*l+w),t.set("scrollTop",g)}})}if(t){var a,c,r,l,d,m,u=e.Node.create('<div class="scroll-bar"></div>'),g=0,p=20,f=2e3,w=10,h=0;if(window._gaq.push(["_trackEvent","InnerLink","Click","nav/drop/mymsg"]),t.next(".scroll-bar"))return u=t.next(".scroll-bar"),u.setStyle("opacity","0.5"),void i();t.ancestor().appendChild(u),this.bindMsgEvent(t,null,function(){n()}),window.setTimeout(function(){n(),d=i(),s()},200)}}},e.mt.www.Tips={success:function(t,n,s){var i=s.node,o=i.getData("parent");n.sysmsg?e.mt.www.SysMsg.init(n.sysmsg,o):n.commontips&&e.mt.www.CommonTips.init(n.commontips.html,n.commontips.info,o)}}},"1.0.0",{requires:["transition","www-base"]});
