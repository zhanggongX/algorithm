;YUI.add("yui-throttle",function(t,n){t.throttle=function(n,i){if(-1===(i=i||(t.config.throttleTime||150)))return function(){n.apply(this,arguments)};var r=t.Lang.now();return function(){var o=t.Lang.now();o-r>i&&(r=o,n.apply(this,arguments))}}},"3.16.0",{requires:["yui-base"]});
;M.add("w-carousel-base",function(t){var e="widget-carousel",i={navlink:e+"-navlink",prev:e+"-navlink-prev",next:e+"-navlink-next",content:e+"-content",list:e+"-list",listitem:e+"-list-item"},n={ndList:"ul",nlItems:["ul li"],previous:"."+i.prev,next:"."+i.next},s={navs:'<a href="#" hidefocus="true" class="widget-carousel-navlink widget-carousel-navlink-prev"></a><a href="#" hidefocus="true" class="widget-carousel-navlink widget-carousel-navlink-next"></a>'},a={ndList:{value:null,setter:function(e){return t.one(e)}},nlItems:{value:null,setter:function(e){return e&&e.size?e:t.all(e)}},itemDimension:{value:0},itemGapDimension:{value:0},winDimension:{value:0},orientation:{value:"horizontal"},fulfill:{value:!0},page:{value:0,setter:function(t){var e=this._metrics.pageCount;return(t+e)%e}},previous:{value:null,setter:function(e){return t.one(e)}},next:{value:null,setter:function(e){return t.one(e)}},itemClickable:{value:!0},slideSpeed:{value:.4}},o=t.Base.create("carouselbase",t.Widget,[],{initializer:function(){var t,e,i=this.get("ndList"),n=this.get("nlItems"),s=this.get("contentBox");if(!i)throw new Error("Y.mt.widget.CarouselBase: 列表节点不存在");"vertical"===this.get("orientation")?this._orientationData={name:"height",slideStart:"top",direction:"Bottom",winDimensionProperty:"offsetHeight"}:this._orientationData={name:"width",slideStart:"left",direction:"Right",winDimensionProperty:"offsetWidth"},this.get("winDimension")||this.set("winDimension",s.get(this._orientationData.winDimensionProperty)),n.size()&&(this.get("itemDimension")||(t=n.item(0).get(this._orientationData.winDimensionProperty),this.set("itemDimension",t)),this.get("itemGapDimension")||(e=n.item(0).getStyle("margin"+this._orientationData.direction),this.set("itemGapDimension",parseInt(e,10)||0))),this._calculateMetrics()},renderUI:function(){this._renderItems(),this._renderItemsNav()},bindUI:function(){var e=this.get("contentBox");this.after("pageChange",this._afterPageChange),e.delegate("click",t.bind(this._onItemClick,this),"."+o.CSS_NAME.listitem),this._hasNavlink&&e.delegate("click",t.bind(this._onNavLinkClick,this),"."+o.CSS_NAME.navlink)},syncUI:function(){this.get("nlItems").size()&&this._syncPageView()},_calculateMetrics:function(){var t=this.get("itemDimension"),e=this.get("itemGapDimension"),i=this.get("winDimension"),n=(this.get("ndList"),this.get("nlItems")),s=(this.get("orientation"),t+e);if(0===s)throw new Error("Y.mt.widget.CarouselBase: 展示项的宽度为 0");var a=n&&n.size()||0,o=i+e,r=Math.floor(o/s),l=r*s,h=Math.ceil(a/r),g=s*a;this.get("fulfill")||(g=(h-1)*l+o),this._metrics={itemBoxDimension:s,itemCount:a,fixedWinDimension:o,singlePageItemCount:r,singlePageDimension:l,pageCount:h,totalDimension:g,shift:0},this._dir="next",this._hasNavlink=!1,h>1&&(this._hasNavlink=!0)},_renderItems:function(){var t=this.get("ndList"),e=this.get("nlItems"),i=this.get("contentBox");e.size()&&(i.addClass(o.CSS_NAME.content+"--"+this.get("orientation")),t.addClass(o.CSS_NAME.list),e.addClass(o.CSS_NAME.listitem),e.each(function(t,e){t.setData("index",e)}),t.setStyle(this._orientationData.name,this._metrics.totalDimension),t.setStyle(this._orientationData.slideStart,0))},_renderItemsNav:function(){var e,i,n=this.get("previous"),s=this.get("next"),a=this.get("contentBox");n&&s?this._hasNavlink?(n.addClass(o.CSS_NAME.navlink),n.addClass(o.CSS_NAME.prev),s.addClass(o.CSS_NAME.navlink),s.addClass(o.CSS_NAME.next)):(n.hide(),s.hide()):this._hasNavlink&&(e=o.TEMPLATE.navs,i=t.Node.create(e),n=i.one("."+o.CSS_NAME.prev),s=i.one("."+o.CSS_NAME.next),this.set("previous",n),this.set("next",s)),a.append(n),a.append(s)},nextPage:function(){this.set("page",this.get("page")+1)},prevPage:function(){this.set("page",this.get("page")-1)},_afterPageChange:function(t){var e=this._metrics,i=e.shift,n=e.totalDimension,s=e.singlePageDimension,a=(t.newVal-t.prevVal)*s,o=e.fixedWinDimension,r=i+a;r<0?(this._dir="next",r=0):r+o>n&&(this._dir="prev",r=n-o),e.shift=r,this._syncPageView()},_onItemClick:function(t){var e=t.currentTarget,i=+e.getData("index");this.get("itemClickable")&&this.set("page",this._getPageByIndex(i)),this.fire("itemClick",e,i)},_onNavLinkClick:function(t){t.preventDefault(),t.target.hasClass(o.CSS_NAME.prev)?this.prevPage():this.nextPage()},_getPageByIndex:function(t){var e=this._metrics,i=(e.totalDimension,e.itemCount),n=e.pageCount,s=e.singlePageItemCount;e.shift;return"next"!==this._dir&&this.get("fulfill")?n-Math.ceil((i-t)/s):Math.ceil((t+1)/s)-1},_syncPageView:function(){var e=this.get("page"),i=this._metrics.pageCount,n={node:this.get("ndList"),to:{},duration:this.get("slideSpeed"),easing:"easeIn"};n.to[this._orientationData.slideStart]=-this._metrics.shift,new t.Anim(n).run(),this._hasNavlink&&(this.get("previous").show(),this.get("next").show(),0===e?this.get("previous").hide():e===i-1&&this.get("next").hide())}},{NAME:"CarouselBase",ATTRS:a,CSS_PREFIX:e,CSS_NAME:i,HTML_PARSER:n,TEMPLATE:s});t.namespace("mt.widget"),t.mt.widget.CarouselBase=o},"1.0.0",{requires:["mt-base","base-build","widget","anim"],skinnable:!0});
;M.add("www-dishlist",function(t){function e(e){this._options=t.merge({show:!1},e||{}),this._ndContainer=t.one("#meishi-menu"),this._ndContainer&&(this._ndPrompt=this._ndContainer.one(".prompt"),this.initMenu(),this.initCarousel(),this.initSliderList())}var i=t.mt.widget.Slider,n=t.mt.widget.CarouselBase;e.prototype.initMenu=function(){var t=this._ndContainer.one(".more");t&&t.on("click",this.toggleMenu)},e.prototype.initCarousel=function(){var t=this._ndContainer.one(".thumbnails");if(t){new n({srcNode:t,itemSize:130,itemGapSize:6,winSize:680,fulfill:!1}).render()}},e.prototype.initSliderList=function(){var e=this,i=e._options.show,n=e._ndContainer.all(".thumbnails li"),o=e._ndContainer.all(".preview");n.isEmpty()||t.each(n,function(t,r){var s=o.item(r);e.initSlider(s),i&&0===r&&(s.removeClass("hidden"),e.lazyload(s)),t.on("click",function(){n.each(function(e){e===t?e.toggleClass("current"):e.removeClass("current")}),e.lazyload(s),o.each(function(t){t===s?t.toggleClass("hidden"):t.addClass("hidden")})})},e)},e.prototype.initSlider=function(t){var e,n=this,o=t.one(".cover"),r=t.one(".previous"),s=t.one(".next"),a=t.one("ul"),l=new i({sheetContainer:a,autoPlay:!1,effect:"slideFadeIn",duration:10});r.on("click",function(){var t=o.get("text"),i=l.get("index")+1;1===i?n.prompt("已经是第一张图片"):(l.showPrevious(),e=a.all("> li img").item(l.get("index")).getStyle("height"),a.setStyle("height",e),o.set("text",t.replace(i,l.get("index")+1)))}),s.on("click",function(){var i=o.get("text"),r=l.get("index")+1;r===t.all("li").size()?n.prompt("已经是最后一张图片"):(l.showNext(),e=a.all("> li img").item(l.get("index")).getStyle("height"),a.setStyle("height",e),o.set("text",i.replace(r,l.get("index")+1)))}),l.render()},e.prototype.toggleMenu=function(){var e=t.all("#meishi-menu table");t.each(e,function(t){t.toggleClass("hidden")})},e.prototype.prompt=t.throttle(function(t){var e=this;e._ndPrompt.set("text",t),e._ndPrompt.show(),setTimeout(function(){e._ndPrompt.hide()},1e3)},1e3);e.prototype.lazyload=function(t){t.all("img[data-src]").each(function(t){var e=t.getAttribute("data-src");e&&(t.set("src",e),t.removeAttribute("data-src"))})},t.namespace("mt.www.Dishlist"),t.mt.www.Dishlist=e},"1.0.0",{requires:["node","yui-throttle","www-base","w-slider","w-carousel-base"]});
