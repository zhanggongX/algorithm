;YUI.add("gesture-simulate",function(t,e){function i(i){i||t.error(e+": invalid target node"),this.node=i,this.target=t.Node.getDOMNode(i);var n=this.node.getXY(),r=this._getDims();a=n[0]+r[0]/2,s=n[1]+r[1]/2}var n,a,s,e="gesture-simulate",r=t.config.win&&"ontouchstart"in t.config.win&&!t.UA.phantomjs&&!(t.UA.chrome&&t.UA.chrome<6),o={tap:1,doubletap:1,press:1,move:1,flick:1,pinch:1,rotate:1},c={touchstart:1,touchmove:1,touchend:1,touchcancel:1},h=t.config.doc,u={HOLD_TAP:10,DELAY_TAP:10,HOLD_PRESS:3e3,MIN_HOLD_PRESS:1e3,MAX_HOLD_PRESS:6e4,DISTANCE_MOVE:200,DURATION_MOVE:1e3,MAX_DURATION_MOVE:5e3,MIN_VELOCITY_FLICK:1.3,DISTANCE_FLICK:200,DURATION_FLICK:1e3,MAX_DURATION_FLICK:5e3,DURATION_PINCH:1e3},g="touchstart",d="touchmove",l="touchend",m="mouseup";i.prototype={_toRadian:function(t){return t*(Math.PI/180)},_getDims:function(){var t,e,i;return this.target.getBoundingClientRect?(t=this.target.getBoundingClientRect(),i="height"in t?t.height:Math.abs(t.bottom-t.top),e="width"in t?t.width:Math.abs(t.right-t.left)):(t=this.node.get("region"),e=t.width,i=t.height),[e,i]},_calculateDefaultPoint:function(e){var i;return t.Lang.isArray(e)&&0!==e.length?(1==e.length&&(i=this._getDims[1],e[1]=i/2),e[0]=this.node.getX()+e[0],e[1]=this.node.getY()+e[1]):e=[a,s],e},rotate:function(i,n,a,s,r,o,c){var h,u=a,g=s;(!t.Lang.isNumber(u)||!t.Lang.isNumber(g)||u<0||g<0)&&(h=this.target.offsetWidth<this.target.offsetHeight?this.target.offsetWidth/4:this.target.offsetHeight/4,u=h,g=h),t.Lang.isNumber(c)||t.error(e+"Invalid rotation detected."),this.pinch(i,n,u,g,r,o,c)},pinch:function(i,n,a,s,r,o,c){var h,m,_,f,p,L,T,X,A,E,v,Y,N,M=0,I=a,D=s,O={start:[],end:[]},R={start:[],end:[]};if(n=this._calculateDefaultPoint(n),(!t.Lang.isNumber(I)||!t.Lang.isNumber(D)||I<0||D<0)&&t.error(e+"Invalid startRadius and endRadius detected."),(!t.Lang.isNumber(r)||r<=0)&&(r=u.DURATION_PINCH),t.Lang.isNumber(o))for(o%=360;o<0;)o+=360;else o=0;for(t.Lang.isNumber(c)||(c=0),t.AsyncQueue.defaults.timeout=20,h=new t.AsyncQueue,f=n[0],p=n[1],A=o,E=o+c,O.start=[f+I*Math.sin(this._toRadian(A)),p-I*Math.cos(this._toRadian(A))],O.end=[f+D*Math.sin(this._toRadian(E)),p-D*Math.cos(this._toRadian(E))],R.start=[f-I*Math.sin(this._toRadian(A)),p+I*Math.cos(this._toRadian(A))],R.end=[f-D*Math.sin(this._toRadian(E)),p+D*Math.cos(this._toRadian(E))],L=1,T=s/a,h.add({fn:function(){var e,i,n,a;e={pageX:O.start[0],pageY:O.start[1],clientX:O.start[0],clientY:O.start[1]},i={pageX:R.start[0],pageY:R.start[1],clientX:R.start[0],clientY:R.start[1]},a=this._createTouchList([t.merge({identifier:M++},e),t.merge({identifier:M++},i)]),n={pageX:(O.start[0]+R.start[0])/2,pageY:(O.start[0]+R.start[1])/2,clientX:(O.start[0]+R.start[0])/2,clientY:(O.start[0]+R.start[1])/2},this._simulateEvent(this.target,g,t.merge({touches:a,targetTouches:a,changedTouches:a,scale:L,rotation:A},n)),t.UA.ios>=2&&this._simulateEvent(this.target,"gesturestart",t.merge({scale:L,rotation:A},n))},timeout:0,context:this}),Y=Math.floor(r/20),_=(D-I)/Y,X=(T-L)/Y,v=(E-A)/Y,N=function(e){var i,n,a,s,r=I+_*e,o=f+r*Math.sin(this._toRadian(A+v*e)),c=p-r*Math.cos(this._toRadian(A+v*e)),h=f-r*Math.sin(this._toRadian(A+v*e)),u=p+r*Math.cos(this._toRadian(A+v*e)),g=(o+h)/2,l=(c+u)/2;i={pageX:o,pageY:c,clientX:o,clientY:c},n={pageX:h,pageY:u,clientX:h,clientY:u},s=this._createTouchList([t.merge({identifier:M++},i),t.merge({identifier:M++},n)]),a={pageX:g,pageY:l,clientX:g,clientY:l},this._simulateEvent(this.target,d,t.merge({touches:s,targetTouches:s,changedTouches:s,scale:L+X*e,rotation:A+v*e},a)),t.UA.ios>=2&&this._simulateEvent(this.target,"gesturechange",t.merge({scale:L+X*e,rotation:A+v*e},a))},m=0;m<Y;m++)h.add({fn:N,args:[m],context:this});h.add({fn:function(){var e,i,n,a,s=this._getEmptyTouchList();e={pageX:O.end[0],pageY:O.end[1],clientX:O.end[0],clientY:O.end[1]},i={pageX:R.end[0],pageY:R.end[1],clientX:R.end[0],clientY:R.end[1]},a=this._createTouchList([t.merge({identifier:M++},e),t.merge({identifier:M++},i)]),n={pageX:(O.end[0]+R.end[0])/2,pageY:(O.end[0]+R.end[1])/2,clientX:(O.end[0]+R.end[0])/2,clientY:(O.end[0]+R.end[1])/2},t.UA.ios>=2&&this._simulateEvent(this.target,"gestureend",t.merge({scale:T,rotation:E},n)),this._simulateEvent(this.target,l,t.merge({touches:s,targetTouches:s,changedTouches:a,scale:T,rotation:E},n))},context:this}),i&&t.Lang.isFunction(i)&&h.add({fn:i,context:this.node}),h.run()},tap:function(e,i,n,a,s){var o,c,h,d,m,_=new t.AsyncQueue,f=this._getEmptyTouchList();for(i=this._calculateDefaultPoint(i),(!t.Lang.isNumber(n)||n<1)&&(n=1),t.Lang.isNumber(a)||(a=u.HOLD_TAP),t.Lang.isNumber(s)||(s=u.DELAY_TAP),c={pageX:i[0],pageY:i[1],clientX:i[0],clientY:i[1]},o=this._createTouchList([t.merge({identifier:0},c)]),d=function(){this._simulateEvent(this.target,g,t.merge({touches:o,targetTouches:o,changedTouches:o},c))},m=function(){this._simulateEvent(this.target,l,t.merge({touches:f,targetTouches:f,changedTouches:o},c))},h=0;h<n;h++)_.add({fn:d,context:this,timeout:0===h?0:s}),_.add({fn:m,context:this,timeout:a});n>1&&!r&&_.add({fn:function(){this._simulateEvent(this.target,"dblclick",c)},context:this}),e&&t.Lang.isFunction(e)&&_.add({fn:e,context:this.node}),_.run()},flick:function(i,n,a,s,r){var o;n=this._calculateDefaultPoint(n),t.Lang.isString(a)?"x"!==(a=a.toLowerCase())&&"y"!==a&&t.error(e+"(flick): Only x or y axis allowed"):a="x",t.Lang.isNumber(s)||(s=u.DISTANCE_FLICK),t.Lang.isNumber(r)?r>u.MAX_DURATION_FLICK&&(r=u.MAX_DURATION_FLICK):r=u.DURATION_FLICK,Math.abs(s)/r<u.MIN_VELOCITY_FLICK&&(r=Math.abs(s)/u.MIN_VELOCITY_FLICK),o={start:t.clone(n),end:["x"===a?n[0]+s:n[0],"y"===a?n[1]+s:n[1]]},this._move(i,o,r)},move:function(e,i,n){var a;t.Lang.isObject(i)?(t.Lang.isArray(i.point)?i.point=this._calculateDefaultPoint(i.point):i.point=this._calculateDefaultPoint([]),t.Lang.isNumber(i.xdist)||(i.xdist=u.DISTANCE_MOVE),t.Lang.isNumber(i.ydist)||(i.ydist=0)):i={point:this._calculateDefaultPoint([]),xdist:u.DISTANCE_MOVE,ydist:0},t.Lang.isNumber(n)?n>u.MAX_DURATION_MOVE&&(n=u.MAX_DURATION_MOVE):n=u.DURATION_MOVE,a={start:t.clone(i.point),end:[i.point[0]+i.xdist,i.point[1]+i.ydist]},this._move(e,a,n)},_move:function(e,i,n){var r,o,c,h,m,_,f=0;for(t.Lang.isNumber(n)?n>u.MAX_DURATION_MOVE&&(n=u.MAX_DURATION_MOVE):n=u.DURATION_MOVE,t.Lang.isObject(i)?(t.Lang.isArray(i.start)||(i.start=[a,s]),t.Lang.isArray(i.end)||(i.end=[a+u.DISTANCE_MOVE,s])):i={start:[a,s],end:[a+u.DISTANCE_MOVE,s]},t.AsyncQueue.defaults.timeout=20,r=new t.AsyncQueue,r.add({fn:function(){var e={pageX:i.start[0],pageY:i.start[1],clientX:i.start[0],clientY:i.start[1]},n=this._createTouchList([t.merge({identifier:f++},e)]);this._simulateEvent(this.target,g,t.merge({touches:n,targetTouches:n,changedTouches:n},e))},timeout:0,context:this}),c=Math.floor(n/20),h=(i.end[0]-i.start[0])/c,m=(i.end[1]-i.start[1])/c,_=function(e){var n=i.start[0]+h*e,a=i.start[1]+m*e,s={pageX:n,pageY:a,clientX:n,clientY:a},r=this._createTouchList([t.merge({identifier:f++},s)]);this._simulateEvent(this.target,d,t.merge({touches:r,targetTouches:r,changedTouches:r},s))},o=0;o<c;o++)r.add({fn:_,args:[o],context:this});r.add({fn:function(){var e={pageX:i.end[0],pageY:i.end[1],clientX:i.end[0],clientY:i.end[1]},n=this._createTouchList([t.merge({identifier:f},e)]);this._simulateEvent(this.target,d,t.merge({touches:n,targetTouches:n,changedTouches:n},e))},timeout:0,context:this}),r.add({fn:function(){var e={pageX:i.end[0],pageY:i.end[1],clientX:i.end[0],clientY:i.end[1]},n=this._getEmptyTouchList(),a=this._createTouchList([t.merge({identifier:f},e)]);this._simulateEvent(this.target,l,t.merge({touches:n,targetTouches:n,changedTouches:a},e))},context:this}),e&&t.Lang.isFunction(e)&&r.add({fn:e,context:this.node}),r.run()},_getEmptyTouchList:function(){return n||(n=this._createTouchList([])),n},_createTouchList:function(i){var n,a=[],s=this;return i&&t.Lang.isArray(i)?t.UA.android&&t.UA.android>=4||t.UA.ios&&t.UA.ios>=2?(t.each(i,function(e){e.identifier||(e.identifier=0),e.pageX||(e.pageX=0),e.pageY||(e.pageY=0),e.screenX||(e.screenX=0),e.screenY||(e.screenY=0),a.push(h.createTouch(t.config.win,s.target,e.identifier,e.pageX,e.pageY,e.screenX,e.screenY))}),n=h.createTouchList.apply(h,a)):t.UA.ios&&t.UA.ios<2?t.error(e+": No touch event simulation framework present."):(n=[],t.each(i,function(t){t.identifier||(t.identifier=0),t.clientX||(t.clientX=0),t.clientY||(t.clientY=0),t.pageX||(t.pageX=0),t.pageY||(t.pageY=0),t.screenX||(t.screenX=0),t.screenY||(t.screenY=0),n.push({target:s.target,identifier:t.identifier,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY,screenX:t.screenX,screenY:t.screenY})}),n.item=function(t){return n[t]}):t.error(e+": Invalid touchPoints passed"),n},_simulateEvent:function(e,i,n){var a;c[i]?r?t.Event.simulate(e,i,n):this._isSingleTouch(n.touches,n.targetTouches,n.changedTouches)?(i={touchstart:"mousedown",touchmove:"mousemove",touchend:m}[i],n.button=0,n.relatedTarget=null,a=i===m?n.changedTouches:n.touches,n=t.mix(n,{screenX:a.item(0).screenX,screenY:a.item(0).screenY,clientX:a.item(0).clientX,clientY:a.item(0).clientY},!0),t.Event.simulate(e,i,n),i==m&&t.Event.simulate(e,"click",n)):t.error("_simulateEvent(): Event '"+i+"' has multi touch objects that can't be simulated in your platform."):t.Event.simulate(e,i,n)},_isSingleTouch:function(t,e,i){return t&&t.length<=1&&e&&e.length<=1&&i&&i.length<=1}},t.GestureSimulation=i,t.GestureSimulation.defaults=u,t.GestureSimulation.GESTURES=o,t.Event.simulateGesture=function(i,n,a,s){i=t.one(i);var r=new t.GestureSimulation(i);if(n=n.toLowerCase(),!s&&t.Lang.isFunction(a)&&(s=a,a={}),a=a||{},o[n])switch(n){case"tap":r.tap(s,a.point,a.times,a.hold,a.delay);break;case"doubletap":r.tap(s,a.point,2);break;case"press":t.Lang.isNumber(a.hold)?a.hold<u.MIN_HOLD_PRESS?a.hold=u.MIN_HOLD_PRESS:a.hold>u.MAX_HOLD_PRESS&&(a.hold=u.MAX_HOLD_PRESS):a.hold=u.HOLD_PRESS,r.tap(s,a.point,1,a.hold);break;case"move":r.move(s,a.path,a.duration);break;case"flick":r.flick(s,a.point,a.axis,a.distance,a.duration);break;case"pinch":r.pinch(s,a.center,a.r1,a.r2,a.duration,a.start,a.rotation);break;case"rotate":r.rotate(s,a.center,a.r1,a.r2,a.duration,a.start,a.rotation)}else t.error(e+": Not a supported gesture simulation: "+n)}},"3.16.0",{requires:["async-queue","event-simulate","node-screen"]});
;YUI.add("node-event-simulate",function(e,t){e.Node.prototype.simulate=function(t,s){e.Event.simulate(e.Node.getDOMNode(this),t,s)},e.Node.prototype.simulateGesture=function(t,s,u){e.Event.simulateGesture(this,t,s,u)}},"3.16.0",{requires:["node-base","event-simulate","gesture-simulate"]});
;YUI.add("selector-css3",function(e,t){e.Selector._reNth=/^(?:([\-]?\d*)(n){1}|(odd|even)$)*([\-+]?\d*)$/,e.Selector._getNth=function(t,n,r,o){e.Selector._reNth.test(n);var c=parseInt(RegExp.$1,10),l=RegExp.$2,i=RegExp.$3,a=parseInt(RegExp.$4,10)||0,u=e.DOM._children(t.parentNode,r);if(i?(c=2,"+",l="n",a="odd"===i?1:0):isNaN(c)&&(c=l?1:0),0===c)return o&&(a=u.length-a+1),u[a-1]===t;if(c<0&&(o=!!o,c=Math.abs(c)),o){for(var d=u.length-a,h=u.length;d>=0;d-=c)if(d<h&&u[d]===t)return!0}else for(var d=a-1,h=u.length;d<h;d+=c)if(d>=0&&u[d]===t)return!0;return!1},e.mix(e.Selector.pseudos,{root:function(e){return e===e.ownerDocument.documentElement},"nth-child":function(t,n){return e.Selector._getNth(t,n)},"nth-last-child":function(t,n){return e.Selector._getNth(t,n,null,!0)},"nth-of-type":function(t,n){return e.Selector._getNth(t,n,t.tagName)},"nth-last-of-type":function(t,n){return e.Selector._getNth(t,n,t.tagName,!0)},"last-child":function(t){var n=e.DOM._children(t.parentNode);return n[n.length-1]===t},"first-of-type":function(t){return e.DOM._children(t.parentNode,t.tagName)[0]===t},"last-of-type":function(t){var n=e.DOM._children(t.parentNode,t.tagName);return n[n.length-1]===t},"only-child":function(t){var n=e.DOM._children(t.parentNode);return 1===n.length&&n[0]===t},"only-of-type":function(t){var n=e.DOM._children(t.parentNode,t.tagName);return 1===n.length&&n[0]===t},empty:function(e){return 0===e.childNodes.length},not:function(t,n){return!e.Selector.test(t,n)},contains:function(e,t){return(e.innerText||e.textContent||"").indexOf(t)>-1},checked:function(e){return!0===e.checked||!0===e.selected},enabled:function(e){return e.disabled!==undefined&&!e.disabled},disabled:function(e){return e.disabled}}),e.mix(e.Selector.operators,{"^=":"^{val}","$=":"{val}$","*=":"{val}"}),e.Selector.combinators["~"]={axis:"previousSibling"}},"3.16.0",{requires:["selector-native","selector-css2"]});
;M.add("www-biz",function(e){var t,i,o=e.io,n=e.Node,a=e.Lang.trim,r=e.mt.www,l=e.mt.www.PageNav,c=e.mt.util,d=e.mt.lang,s=e.mt.FormChecker,f=e.mt.www.Ratelist;e.mt.www.Biz={initApply:function(t,i,o){function r(e){var i=e.get("value");return!0===t.one("#online").get("checked")&&""===a(i)&&"请输入线上店铺地址"}function l(e){var t=e.get("value");return""===a(t)?"请输入销售数量":!!/\D/g.test(t)&&"请输入数字"}if(t=e.one(t)){var d,f,u,p,g,m,h,v=c.field(t,"corporation"),w=c.field(t,"contact"),T=c.field(t,"mobile"),b=c.field(t,"firstcategory"),y=c.field(t,"email"),k=c.field(t,"online-address"),C=c.field(t,"capital"),M=c.field(t,"founded-time"),x=c.field(t,"business-license"),F=e.one("#salecase-markup"),E=e.one("#product-markup"),H=i+1,L=o+1;for(d=new s({form:t,fields:{coperation:{node:v,validateFn:s.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入公司名字"},contact:{node:w,validateFn:s.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入您的名字"},firstcategory:{node:b,validateFn:s.CHECK_EMPTY_FN,typeTip:"",errorTip:"请选择经营品类"},mobile:{node:T,validateFn:s.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入您的电话号码"},url:{node:k,validateFn:r,typeTip:"",errorTip:"请输入您的线上地址"},email:{node:y,validateFn:s.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入您的邮箱地址"},capital:{node:C,validateFn:s.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入公司的注册资金"},time:{node:M,validateReg:/^\d{4}-\d{2}-\d{2}$/,typeTip:"",errorTip:"请输入正确的公司成立时间"},license:{node:x,validateFn:s.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入营业执照号码"}},tipClass:s.CLASS_INLINE_TIP}),f=1;f<=i;f++)u=t.one("#quantity"+f),p=t.one("#description"+f),d.addField(u.get("id"),{node:u,validateFn:l,typeTip:"",errorTip:"请输入销售数量"}),d.addField(p.get("id"),{node:p,validateFn:s.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入案例链接或描述"});for(f=1;f<=o;f++)g=t.one("#brand"+f),m=t.one("#name-model"+f),h=t.one("#show-link"+f),d.addField(g.get("id"),{node:g,validateFn:s.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入产品品牌"}),d.addField(m.get("id"),{node:m,validateFn:s.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入产品名称及型号"}),d.addField(h.get("id"),{node:h,validateFn:s.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入产品展示链接"});t.delegate("click",function(t){t.preventDefault();var i=n.create(e.Lang.sub(F.getHTML(),{index:H})),o=i.one(".quantity"),a=i.one(".description");H+=1,d.addField(o.get("id"),{node:o,validateFn:l,typeTip:"",errorTip:"请输入销售数量"}),d.addField(a.get("id"),{node:a,validateFn:s.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入案例链接或描述"}),this.ancestor().insert(i,"before")},"#add-business"),t.delegate("click",function(t){t.preventDefault();var i=n.create(e.Lang.sub(E.getHTML(),{index:L})),o=i.one(".productbrand"),a=i.one(".productname"),r=i.one(".productlink");L+=1,d.addField(o.get("id"),{node:o,validateFn:s.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入产品品牌"}),d.addField(a.get("id"),{node:a,validateFn:s.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入产品名称及型号"}),d.addField(r.get("id"),{node:r,validateFn:s.CHECK_EMPTY_FN,typeTip:"",errorTip:"请输入产品展示链接"}),this.ancestor().insert(i,"before")},"#add-product"),t.delegate("click",function(e){e.preventDefault(),this.ancestor().remove()},".delete"),t.delegate("click",function(){var e;!0===this.one("#offline").get("checked")&&(e=d.get("fields").url,d.clearTip(e),e.status=s.STATUS_INIT)},"#sale-channel")}},initPOI:function(t,i,n){function a(){d(),z&&P&&P.on("click",function(){s(_)}),J&&J.delegate("click",function(){p()},"a"),b&&b.delegate("click",function(){this.hasClass(Y)||(Y="offline"===Y?"online":"offline",h())},".biz-box-title"),I&&(I.delegate("click",E.selectMovie,".reco-movieinfo"),I.all(".reco-movieinfo").each(function(e){e.on("movieinfo.select",E.selectMovie)}),I.delegate("click",E.selectMovieDate,".show-time .show-time-tag"),n.after("indexChange",function(){E.switchSlider(n)})),T()}function d(){H.delegate("click",function(){var e=this.ancestor("dd"),t=e.one(".J-toggle-points"),i=e.one(".J-toggle-actor-more"),o=e.one(".J-toggle-actor-info");"none"===i.getStyle("display")?(t.hide(),i.show(),o.setHTML("收起")):(t.show(),i.hide(),o.setHTML("展开"))},".J-toggle-actor-info")}function s(t){e.use("mt-dialog",function(e){var i=null;k=new e.mt.Dialog({id:K,width:"500px",title:"信息报错",content:e.Lang.sub(z.getHTML(),{shopName:t,poiid:L})}),k.open(),i=e.one("#"+K),f(i)})}function f(t){var i=t.one("form"),n=t.one(".field-group--error"),a=t.one("#report-error-info");a.plug(e.mt.plugin.Placeholder),i.on("submit",function(e){var t=a.get("value");if(e.halt(),""===t)return void n.show();n.hide(),r.disableButton(y,!0),o(i.get("action"),{method:"POST",form:{id:i},on:{success:function(e,t){u(!!c.getEvalRes(t).status)},failure:function(){}}})})}function u(e){var t;t=e?{type:"success",title:"提交成功！",tip:"感谢您的报错信息."}:{type:"failure",title:"提交失败",tip:"网络有问题，请稍候重试"},k.showResult(t),k.set("autoHide",2)}function p(){var i,n,a,r,l=null;n={poiid:L,picCount:t.imgCount},i=e.Lang.sub("/biz/getImg/{poiid}/{picCount}",n),o(i,{method:"GET",on:{success:function(t,i){var o=c.getEvalRes(i),n=o.imginfo;o.status&&e.use("mt-dialog",function(e){a=g(n,e.mt.Dialog),l=e.one("#"+A),a.on("endAnim",function(e){r=l.one(".picIndex"),r.setHTML('<span class="picIndex">'+(e.index+1)+"</span>")}),l.delegate("click",function(){a.reset()},".close")})},failure:function(){},end:function(){}}})}function g(t,i){if(!N)return null;var o,n,a=t.list,r="",l=a.length;for(o=0;o<l;++o)r+='<li><img width="440" height="300" src='+a[o].url+"></li>";return C=new i({id:A,width:"622px",height:"420px",content:e.Lang.sub(N.getHTML(),{imgItems:r,picIndex:1,picCount:l})}),C.open(),n=new e.mt.widget.Slider({srcNode:".image-wrap",effect:"slideFadeIn",sheetContainer:".image-box",width:440,next:".pic-next",previous:".pic-pre"}),n.render(),n}function m(i){var n,a,r,l={poiid:L,offset:0,typeId:t.typeid,type:Y};i=e.merge(l,i),n=e.Lang.sub("/biz/poideals/{poiid}/{type}/{typeId}/page{offset}",i),r="online"===i.type?".J-online-deals":".J-offline-deals",a=S.one(r),a.getHTML()||a.setHTML('<li class="loading">'+R.getHTML()+"</li>"),o(n,{method:"GET",on:{success:function(t,i){var o=c.getEvalRes(i),n=o.data;o.status&&(a.setHTML(n.poiDeals),e.mt.www.ImageLazyLoader.loadImmediately(a),F[Y].currPage=n.pageNav.nowPage,h(),e.Global.fire("PageHeight:change"),e.fire("PageHeight:change:bizOffline"))},failure:function(){},end:function(){}}})}function h(){x.render({currentPage:F[Y].currPage,maxPage:F[Y].pages})}function v(t,i,n){o("/shop/qualificationpic",{method:"POST",data:c.toPostData({code:t,type:i,captcha:n}),on:{success:function(t,i){var o=c.getEvalRes(i);if(0===o.status)alert(o.msg);else{new e.mt.Dialog({id:"res-dialog",width:"800px",content:'<div style="width:800px;height:600px;overflow:scroll;"><img  src="'+o.data+'"/></div>'}).open()}}}})}function w(e){if(e){var t=e.get("src").replace(/((\?)rnd=0\.\d+)?$/,"");e.set("src",t+"?rnd="+Math.random())}}function T(){var t=e.one(".J-shop-license"),i=e.one(".J-shop-permit");(t||i)&&e.use(["w-bubbletip","mt-dialog"],function(){var o=c.decodeJSON(t.getData("foodSafe"));if(t&&o&&"false"!==t.getData("isLogin")){var n;e.one("body").delegate("click",function(t){new e.mt.Dialog({id:"mt-dialog",width:"640px",content:e.Lang.sub(O.getHTML(),o)}).open()},".J-lookup-certificate, .J-lookup-permit"),e.one("body").delegate("click",function(t){var i=t.currentTarget;n.close(),v(o.code,i.getData("type")||"",e.one(".J-captcha").get("value"))},".J-commitLicence-button"),e.one("body").delegate("click",function(t){t.currentTarget.hasClass("J-captcha-refresh")&&w(e.one(".J-captcha-img"))},".J-captcha-refresh")}if(i){var a,r="false"===i.getData("islogin");!a&&r&&(a=new e.mt.widget.BubbleTip({node:i,id:"permitBubbleTip",alignment:"bottom",tip:"<span>未登录不可查看食品安全档案</span>"}),a.render())}})}var b,y,k,C,M,x,F,E=this,H=e.one("#J-biz"),L=t.id,_=t.name,D=H.one(".evaluate-box"),P=H.one(".report-error-link"),J=H.one(".biz-picture"),z=H.one("#report-error-markup"),N=H.one("#pop-picture-markup"),S=e.one(".goods-info"),I=e.one(".movie-box"),R=H.one("#loading-markup"),O=H.one("#food-safety-info-markup"),Y="online",K="report-error-dialog",A="pop-picture-dialog";!function(){var t=H.one(".long-biz-info"),i=H.one(".short-biz-info");H.delegate("click",function(){t&&"none"===t.getStyle("display")?(i.hide(),t.show()):i&&"none"===i.getStyle("display")&&(i.show(),t.hide())},".J-toggle-biz-info"),H.delegate("click",function(){this.ancestor().siblings(".J-toggler-field~.field-group").toggleClass("hidden");var t=["更多信息","收起信息"];this.set("text",t[1-e.Array.indexOf(t,this.get("text"))])},".J-toggle-poimore")}(),function(){H.delegate("click",function(){this.ancestor().all(".more").removeClass("hidden"),this.remove(!0)},".J-more-trigger")}(),S&&(b=S.one(".tag"),(M=S.one(".paginator"))&&(F=e.JSON.parse(M.getData("pages")),x=new l(M,function(e){m({offset:e.index})}),h())),D&&(e.on("domready",function(){a(),window.location.href.indexOf("#biz-offline")>0&&e.one("#biz-offline").simulate("click"),n&&E.autoSelectMovieInfo(n)}),e.once("PageHeight:change:reviewList",function(){window.location.href.indexOf("#evaluate-box")>0&&window.scrollTo(0,e.one("#evaluate-box").getY())}),e.once("PageHeight:change:bizOffline",function(){window.location.href.indexOf("#biz-offline")>0&&window.scrollTo(0,e.one("#biz-offline").getY())}),E.asyncLoadRecommend(L),E.initPromotion())},initPromotion:function(){e.all(".promotion-active .J-trigger").on("hover",function(e){var t=e.target.ancestor(".promotion-active"),i=t.one(".J-content");t.addClass("promotion-active--hover"),i.setStyle("width",t.get("region").width-2+"px"),i.show()}),e.all(".time-table").each(function(e){e.delegate("mouseleave",function(){var e=this.one(".J-content");this.removeClass("promotion-active--hover"),e.hide()},".J-promotion-active")})},selectMovie:function(){var t,i,o,n,a=this.ancestor(".movie-gallery"),r=a.all(".reco-movieinfo"),l=a.one(".arrow"),c=e.all(".movie-info");i=r.indexOf(this),o=(i+1)%5,t=Math.floor(i/5),t>0&&o>0&&(i-=t),r.removeClass("reco-movieinfo--current"),this.addClass("reco-movieinfo--current"),n=0===o?"666px":156*(o-1)+60+"px",new e.Anim({node:".arrow",from:{left:l.getStyle("left")},to:{left:n},duration:.5,easing:e.Easing.easeBoth}).run(),c.removeClass("movie-info--current"),c.item(i).addClass("movie-info--current")},selectMovieDate:function(){var e,t=this.ancestor(".show-time").all(".show-time-tag"),i=this.ancestor(".movie-info").all(".time-table");e=t.indexOf(this),t.removeClass("date-current"),this.addClass("date-current"),i.removeClass("time-table--current"),i.item(e).addClass("time-table--current")},switchSlider:function(t){var i,o=e.one(".movie-gallery"),n=o.one(".arrow");o.all(".mt-slider-sheet").each(function(e){o.all(".mt-slider-sheet").indexOf(e)===t.get("index")&&(i=e)}),i.one(".reco-movieinfo").fire("movieinfo.select"),n.setStyle("left","60px")},autoSelectMovieInfo:function(t){var i,o,n,a=this.getQueryParams(decodeURI(location.search)),r=e.one(".movie-gallery");if(a.movieid&&r){if(window.scrollTo(0,r.getY()),r.all(".reco-movieinfo").each(function(e){e.getData("movie")===a.movieid&&(i=e,o=r.all(".reco-movieinfo").indexOf(i))}),!i)return;for(var l=0;l<parseInt(o/5,10);l++)t.showNext();i.fire("movieinfo.select"),n=e.one(".movie-info--current").one(".show-time")}a.date&&n&&n.all(".show-time-tag").each(function(e){e.getData("date")===a.date&&e.simulate("click")})},initSeatSelection:function(){function n(e){i?i.open():i=r.Dialog.login({origin:"poi-seat-selection",loginRef:e})}function a(e,t){window.location.href="http://maoyan.meituan.com/xuanzuo/shop/"+e+"/show/"+t+"/seats"}var l=e.one(document),d=null;l.delegate("click",function(e){e.preventDefault(),d&&d.isInProgress()&&d.abort();var i=c.data(this,"pid"),l=c.data(this,"seq");d=o("/movie/xuanzuo/"+l+"/"+i,{method:"GET",on:{success:function(e,o){var d=c.getEvalRes(o);switch(t&&"open"===t._status&&t.close(),d.status){case 1:r.Dialog.alert("已停止售票");break;case 2:r.Dialog.alert("全部座位已售完");break;case 3:n(d.refer);break;case 4:r.Dialog.Mobile.bind(d.content,d.needSmsUp);break;default:a(i,l)}}}})},".J-select-seat")},getQueryParams:function(e){var t,i={},o=e.slice(1),n=o.split("&"),a=n.length;for(t=0;t<a;t++){var r=n[t].split("=")[0]+"",l=n[t].split("=")[1];i[r]=l}return i},asyncLoadRecommend:function(t){var i,o,n,a="/shop/sidedeals/"+t,r=e.mt.www.Deal.AsyncLoader,l=e.one("#J-side-recommend-container"),c=M.window;l&&(i={action:a,async:null,method:"get",wrapper:l,callback:function(e){""!==e.data&&(l.setHTML(e.data),o.detach(),n.detach())}},r.winHeight=e.DOM.winHeight(),o=c.resize(function(){r.winHeight=e.DOM.winHeight(),r.asyncLoadWithCheck(i)},12),n=c.scroll(function(){r.asyncLoadWithCheck(i)},12),r.asyncLoadWithCheck(i))},initZl:function(t,i,n){function a(i){var n,a,l;if("hotel-zhilian-checkin"===i.id){if(p===i.inputValue)return;n=i.date.getTime()+288e5,a=1e3*d.strtotime(u.get("value")),p=i.inputValue,n>=a&&e.use("mt-date",function(e){l=e.mt.date.formatDateByString(new Date(n+864e5),"yyyy-MM-dd"),u.set("value",l),g=l})}else{if(g===i.inputValue)return;a=i.date.getTime()+288e5,n=1e3*d.strtotime(f.get("value")),g=i.inputValue,n>=a&&e.use("mt-date",function(e){l=e.mt.date.formatDateByString(new Date(a-864e5),"yyyy-MM-dd"),f.set("value",l),p=l})}v[p+"_"+g]?r(v[p+"_"+g]):o("/shop/zlRooms/"+t+"/"+p+"/"+g,{method:"GET",on:{success:function(e,t){var i=c.getEvalRes(t);v[p+"_"+g]=i.rooms,r(i.rooms)},failure:function(){}}})}function r(e){var t,i,o,n,a=[],r=e.rooms.length,l=e.wifi?"有wifi":"无wifi",c=e.broadband?"有宽带":"无宽带";for(i=0;i<r;i++)o=e.rooms[i],n="",t="",0===i&&(t=' class="first"'),o.freeCount>0&&o.freeCount<o.alertNum&&(n='<span class="free-count">仅剩'+o.freeCount+"间</span>"),a.push("<li"+t+">"),a.push('<p class="text text--name">'+o.roomName+n+"</p>"),a.push('<p class="text text--description">'+l+"</p>"),a.push('<p class="text text--breakfast">'+c+"</p>"),a.push('<p class="text text--price">¥'+o.soldPrice/100+"</p>"),o.canBooking?a.push('<a href="javascript:void(0)" gaevent="hotel/zhilian/poi/book" data-href="'+o.appointUrl+'" data-loginRef="'+o.appointEncodeUrl+'" class="btn-hot btn-small">立即预订</a>'):a.push('<a class="btn btn-small btn-disabled">已满房</a>');m.setHTML(a.join(""))}function l(t){var i=t.currentTarget.getData("href"),o=t.currentTarget.getData("loginRef");if(n)return void(window.location.href=i);h?h.open():e.use("www-dialog",function(){h=e.mt.www.Dialog.login({origin:"poi-zl",galabel:"zhilian/poi/buy",loginRef:o})})}var s,f,u,p,g,m,h,v=[];s=e.one(".J-hotel-zhilian"),m=s.one(".J-hotel-zhilian__content"),f=s.one("#hotel-zhilian-checkin"),u=s.one("#hotel-zhilian-checkout"),p=f.get("value"),g=u.get("value"),v[p+"_"+g]=i,s.delegate("click",l,".btn-hot"),e.Global.on("Datepicker.select",a),r(i)},asyncLoadFeedbackRecommend:function(t){var i,o,n,a="/deal/sidedeallist/"+t,r=e.mt.www.Deal.AsyncLoader,l=e.one(".J-side-feedback-recommend"),c=M.window;i={action:a,async:null,method:"get",wrapper:l,callback:function(e){""!==e.data&&(l.setHTML(e.data),o.detach(),n.detach())}},r.winHeight=e.DOM.winHeight(),o=c.resize(function(){r.winHeight=e.DOM.winHeight(),r.asyncLoadWithCheck(i)},12),n=c.scroll(function(){r.asyncLoadWithCheck(i)},12),r.asyncLoadWithCheck(i)},initFeedback:function(t){var i=this,o=e.one("#feedback"),n=o.one(".feedback-detail");n&&(e.on("domready",function(){var e=n.one(".feedback-detail__body");f.renderRatePicList(e)}),i.asyncLoadFeedbackRecommend(t))}}},"1.0.0",{requires:["www-base","www-deal","mt-formchecker","www-pagenav","node-event-simulate","anim","www-ratelist","mt-component","selector-css3"]});
;M.add("w-slider",function(e){var t=e.Lang.isFunction,i=e.UA,n=e.mt.util,r={triggerContainer:"mt-slider-trigger-container",triggerContainerEx:"mt-slider-trigger-container-ex",trigger:"mt-slider-trigger",currentTrigger:"mt-slider-current-trigger",sheetContainer:"mt-slider-sheet-container",sheet:"mt-slider-sheet",currentSheet:"mt-slider-current-sheet",previous:"mt-slider-previous",next:"mt-slider-next"},s=e.config["w-slider"]||{},a=function(){a.superclass.constructor.apply(this,arguments)};a.NAME="Slider",a.CSS_PREFIX="mt-slider",a.HTML_PARSER={sheetContainer:"> ."+r.sheetContainer,triggerContainer:"> ."+r.triggerContainer,triggerContainerEx:"> ."+r.triggerContainerEx,previous:"> .previous",next:"> .next"},a.TEMPLATE={trigger:'<a href="javascript:;" hidefocus="true" class="{previous}"></a><a href="javascript:;" hidefocus="true" class="{next}"></a>',statusBar:"<ul></ul>"},a.CLASS_NAME=r,a.ATTRS={sheetContainer:{value:null,setter:function(t){return e.one(t)}},triggerContainerEx:{value:null,setter:function(t){return e.one(t)}},triggerContainer:{value:null,setter:function(t){return e.one(t)}},pnContainer:{value:null,setter:function(t){return e.one(t)}},previous:{value:null,setter:function(t){return e.one(t)}},next:{value:null,setter:function(t){return e.one(t)}},autoPlay:{value:!0},activeStop:{value:!0},pnAutoHide:{value:!1},interval:{value:5e3},effect:{value:"slideLeft"},duration:{value:300},triggerEvent:{value:"click"},index:{value:0},hoverOpacity:{value:i.ie<=8&&i.ie>0?1:.6},lazyloading:{value:!1}},e.extend(a,e.Widget,{initializer:function(){var e=this,t=e.get("sheetContainer"),i=t&&t.all("> li");if(i&&i.isEmpty())throw new Error(a.NAME+": 没有内容页");e._timer=null,e._handles={},e._pause=!1,e._nlSheet=i},destructor:function(){n.detachHandle(this._handles),this.get("boundingBox").remove(!0)},_beforeRenderUI:function(){var e=this.get("index"),t=this._nlSheet,i=t.item(e);this._updateImgs(i),i.show(),"slideFadeIn"===this.get("effect")&&(t.setStyle("opacity",0),i.setStyle("opacity",1))},_afterRenderUI:function(){var e=this._nlSheet,t=(this.get("index")+1)%e.size();this._updateImgs(e.item(t))},_updateImgs:function(e){this.get("lazyloading")&&e.all("img[data-src]").each(function(e){s.cssLazyClass&&e.on("load",function(){e.removeClass(s.cssLazyClass)}),e.set("src",e.getAttribute("data-src")),e.removeAttribute("data-src")})},renderUI:function(){this._beforeRenderUI(),this._renderTriggerContainer(),this._modifySheetContainer(),this._renderPreNextContainer(),this._anim=this._getAnim(),this._afterRenderUI()},_renderTriggerContainer:function(){var e=this.get("triggerContainer"),t=this.get("triggerContainerEx"),i=this._nlSheet,n=this.get("index"),s=0,a=null;e?(s=e.all("> li").size(),i.size()!==s&&e.setHTML(function(){for(var e=[],t=0;t<i.size();t++)e.push("<li></li>");return e.join("")}()),"none"===e.getStyle("display")&&e.show(),a=e.all("> li"),a.addClass(r.trigger),a.item(n).addClass(r.currentTrigger),e.addClass(r.triggerContainer)):t&&(t.one(".total").setHTML(i.size()),t.one(".current").setHTML(1),"none"===t.getStyle("display")&&t.show())},_modifySheetContainer:function(){var e=this.get("sheetContainer"),t=this._nlSheet,i=this.get("index");e.addClass(r.sheetContainer),t.addClass(r.sheet),t.item(i).addClass(r.currentSheet),t.each(function(e,t){t!==i&&e.hide()})},_renderPreNextContainer:function(){var e=this.get("previous"),t=this.get("pnAutoHide"),i=this.get("next");i||e?t&&(e&&(e.setStyle("opacity",0),e.show()),i&&(i.setStyle("opacity",0),i.show())):this.buildPreNext()},buildPreNext:function(){var t,i,n,s=this.get("pnContainer"),o=this.get("pnAutoHide");s&&(n=e.Node.create(e.Lang.sub(a.TEMPLATE.trigger,r)),s.append(n),this.set("previous",t=s.one("."+r.previous)),this.set("next",i=s.one("."+r.next)),o&&(t.setStyle("opacity",0),i.setStyle("opacity",0)))},bindUI:function(){var e=this,t=e.get("triggerContainer"),i=e.get("sheetContainer"),n=this.get("pnAutoHide"),r=t&&t.all("> li");e.isFromNavigator=!1,e.after("indexChange",this._defIndexChangeFn,this),i.on({mouseover:function(){e.pause()},mouseout:function(){e.reset()}}),r&&r.each(function(t,i){t.on(e.get("triggerEvent"),function(t){t.halt(),e.set("index",i),e._activeStop=!0,e.reset()})}),this.lrBtnClickHandler(),n&&this.handleLrBtnHide()},syncUI:function(){this.get("autoPlay")&&this.play()},lrBtnClickHandler:function(){var e=this.get("previous"),t=this.get("next"),i=this;e&&e.on("click",function(e){e.halt(),i.showPrevious(),i._activeStop=!0,i.reset()}),t&&t.on("click",function(e){e.halt(),i.showNext(),i._activeStop=!0,i.reset()})},handleLrBtnHide:function(){function e(){s.setStyle("opacity",l),a.setStyle("opacity",l)}function t(e){e.pageX>n.left&&e.pageX<n.left+n.width&&e.pageY>n.top&&e.pageY<n.top+n.height||(s.setStyle("opacity",0),a.setStyle("opacity",0))}var i,n,r,s=this.get("previous"),a=this.get("next"),o=this,l=this.get("hoverOpacity");a&&s&&(r={mouseover:e,mouseout:t},i=o.get("sheetContainer"),n=i.get("region"),i.delegate(r,".mt-slider-sheet"),a.on(r),s.on(r))},_defIndexChangeFn:function(e){var t=this,i=t.get("triggerContainer"),n=t.get("triggerContainerEx"),s=i&&i.all("> li"),a=t._nlSheet,o=a.size(),l=e.prevVal,u=e.newVal;s&&e.newVal>=s.size()||(t._updateImgs(a.item(e.newVal)),s&&(s.item(l).removeClass(r.currentTrigger),s.item(u).addClass(r.currentTrigger)),n&&n.one(".current").setHTML(u+1),t.isFromNavigator||(2===o?t._dir=!0:Math.abs(u-l)===o-1?t._dir=u<l:t._dir=u>l),t._anim(a.item(l),a.item(u)))},_getAnim:function(){var i,n,r,s,o,l,u=this,g=u.get("sheetContainer"),d=u.get("effect"),h=u.get("duration")/1e3,c=null,f=null,p=null,v=!0;switch(d){case"slideHorizontal":case"slideLeft":i=parseInt(g.getStyle("width"),10),n={left:i},o={left:-i},l={left:0},f={nextStyles:{left:i},currentAnimTo:{left:-i}},p={nextStyles:{left:-i},currentAnimTo:{left:i}};break;case"slideVertical":case"slideUp":i=parseInt(g.getStyle("height"),10),n={top:i},o={top:-i},l={top:0},f={nextStyles:{top:i},currentAnimTo:{top:-i}},p={nextStyles:{top:-i},currentAnimTo:{top:i}};break;case"slideFadeIn":o={opacity:0},l={opacity:1};break;default:throw new Error(a.NAME+": 切换效果类型不存在")}return r=new e.Anim({from:{},to:o||{},duration:h,easing:e.Easing.easeBoth}),s=new e.Anim({from:{},to:l||{},duration:h,easing:e.Easing.easeBoth}),c=p||null,function(e,i,a){c&&u._dir!==v&&(v=u._dir,n=c.nextStyles,r.set("to",c.currentAnimTo),c=c===f?p:f),u.isFromNavigator=!1,r.stop(!0),s.stop(!0),n&&i.setStyles(n),i.show(),r.set("node",e),r.detach("end"),r.on("end",function(){e.hide()}),s.set("node",i),s.detach("end"),s.on("end",function(){t(a)&&a(),u.fire("endAnim",{index:u.get("index")})}),r.run(),s.run()}},showPrevious:function(){var e=this,t=e.get("index"),i=e._nlSheet.size(),n=0===t?i-1:(t-1)%i;e.isFromNavigator=!0,e._dir=!1,e.set("index",n)},showNext:function(){var e=this,t=e.get("index"),i=e._nlSheet.size(),n=(t+2)%i,r=(t+1)%i;e.isFromNavigator=!0,e._dir=!0,e.set("index",r),e._updateImgs(this._nlSheet.item(n))},pause:function(){this._pause=!0},reset:function(){var e=this;if(e._pause=!1,e.get("autoPlay")){if(window.clearTimeout(e._timer),e.get("activeStop")&&e._activeStop)return;e.play()}},isPause:function(){return this._pause},play:function(){var e=this;e._timer=window.setTimeout(function(){e.isPause()||(e.showNext(),e.play())},e.get("interval"))}}),e.mt.widget.Slider=a},"1.0.0",{requires:["mt-base","anim","widget","node"],skinnable:!0});
