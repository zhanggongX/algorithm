;M.add("mt-map",function(e){var t,n,o=e.Node,i=e.Lang.isArray;if(window.qq&&window.qq.maps)t=window.qq.maps,n="qq";else{if(!window.google||!window.google.maps)throw new Error("Y.mt.Map: third-party map service supplier required");t=window.google.maps,n="google"}var r=function(){r.superclass.constructor.apply(this,arguments)};r.NAME="MTMap",r.ATTRS={container:{value:null,setter:function(t){return e.one(t)},writeOnce:!0},map:{value:null},bounds:{value:null,setter:"_setBounds"},center:{value:[],setter:"_setCenter",getter:"_getCenter"},zoom:{value:0,validator:"_validateZoom",setter:"_setZoom",getter:"_getZoom"},defaultZoom:{value:13,validator:"_validateZoom",writeOnce:!0},markers:{value:[],setter:"_setMarkers"},infoWindows:{value:[],setter:"_setInfoWindows"},options:{value:{}}};var a={initializer:function(){this.publish("load",{fireOnce:!0,defaultFn:this._defLoadFn})},destructor:function(){var e=this.get("map");"google"===n?t.event.clearInstanceListeners(e):"qq"===n&&t.event.clearListeners(e)},render:function(){if(this.get("container")){var e=this,n=e._getConfig(),i=o.getDOMNode(e.get("container")),r=e.get("infoWindows");e.set("map",new t.Map(i,n)),r&&e._initInfoWindow(),e._initMapEvent(),this.fitBounds()}},fitBounds:function(){var e=this.get("bounds");e&&this.get("markers").length>1&&this.get("map").fitBounds(e)},_getConfig:function(){var o,r,a,s=this,u=s.get("center"),l=s.get("zoom"),d=s.get("defaultZoom"),c=s.get("markers"),f=s.get("options");return i(u)&&2===u.length&&(u=new t.LatLng(u[0],u[1])),u instanceof t.LatLng?(o=u,r=0===l?d:l):(s.set("bounds",c),o=s.get("bounds").getCenter(),r=d),a={center:o,scrollwheel:!0,mapTypeId:t.MapTypeId.ROADMAP,mapTypeControl:!1,position:t.ControlPosition.TOP_RIGHT,panControl:!1,panControlOptions:{position:t.ControlPosition.LEFT_TOP},scaleControl:!1,scaleControlOptions:{position:t.ControlPosition.BOTTOM_RIGHT},zoomControl:!0,zoomControlOptions:{style:t.ZoomControlStyle.SMALL},zoom:r},"qq"!==n&&e.mix(a,{streetViewControl:!1}),e.mix(a,f,!0),a},_initMapEvent:function(){var e=this,t=e.get("map");"google"===n?e.addListener(t,"tilesloaded",function(){e.fire("load")}):e.fire("load")},_initInfoWindow:function(){var t=this,n=t.get("infoWindows"),o=t.get("markers");e.Array.each(n,function(e,n){var i=o[n];t.addListener(i,"click",function(){t.openInfoWindow(n)})})},openInfoWindow:function(t){var o=this,i=o.get("map"),r=o.get("infoWindows"),a=o.get("markers");e.Array.each(r,function(e,o){o===t?"qq"===n?(e.setMap(i),e.setPosition(a[o]),window.setTimeout(function(){e.open()},200)):e.open(i,a[o]):e.close()})},closeInfoWindow:function(e){var t=this.get("infoWindows");e<0||e>=t.length||this.get("infoWindows")[e].close()},_defLoadFn:function(){this.drawMarkers()},subscribe:function(e,t){return this.addListener(this.get("map"),e,t)},addListener:function(e,n,o){t.event.addListener(e,n,o)},drawMarkers:function(){var t=this;e.Array.each(t.get("markers"),function(e){e.setMap(t.get("map"))})},deleteMarkers:function(){var t=this;e.Array.each(t.get("markers"),function(e){e.setMap(null)}),t.set("markers",[])},_setBounds:function(n){if(!n)return null;var o=new t.LatLngBounds;return e.Array.each(n,function(e){e instanceof t.Marker&&o.extend(e.getPosition())}),o},_setCenter:function(e){var n=this.get("map");return n&&(e instanceof t.LatLng?n.setCenter(e):i(e)&&2===e.length&&n.setCenter(new t.LatLng(e[0],e[1]))),e},_getCenter:function(e){var t=this.get("map");return t?t.getCenter():e},_validateZoom:function(e){return/^\d+$/.test(e)},_setZoom:function(e){var t=this.get("map");return t&&("qq"===n?t.setZoomLevel(e):t.setZoom(e)),e},_getZoom:function(e){var t=this.get("map");return t?"qq"===n?t.getZoomLevel():t.getZoom():e},_setMarkers:function(n){var o=[];return e.Array.each(n,function(e){var n={position:new t.LatLng(e.position[0],e.position[1])};e.title&&(n.title=e.title),o.push(new t.Marker(n))}),o},_setInfoWindows:function(n){var o=[];return e.Array.each(n,function(e){var n=null;e&&(n=new t.InfoWindow({content:e})),o.push(n)}),o}};e.extend(r,e.Base,a),e.mt.Map=r},"1.0.0",{requires:["mt-base","base-base","node"]});
